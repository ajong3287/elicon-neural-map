# STEP05.29 ì™„ê²° ì‘ì—… ë¡œê·¸

**ë‚ ì§œ**: 2025-12-26
**ì‘ì—…ì**: í´ë¡œë“œ (Claude Code)
**ì‘ì—… ë²”ìœ„**: STEP05.29 Issue URL ì—­ì‚½ì… (ì™„ì „ íë£¨í”„ ì™„ì„±)

---

## ì‘ì—… ìš”ì•½

### ì™„ë£Œëœ PR

| PR | ì œëª© | íŒŒì¼ ìˆ˜ | ìƒíƒœ | URL |
|---|------|--------|------|-----|
| #39 | STEP05.29 â€” Issue URL Backlink to Package/Report | 2 | OPEN | https://github.com/ajong3287/elicon-neural-map/pull/39 |

---

## PR #39 (STEP05.29)

### ëª©ì 
- **ì™„ì „ íë£¨í”„(1í´ë¦­â†’ì´ìŠˆ/íŒ¨í‚¤ì§€/ë§í¬ ìë™ ì •ë¦¬)**
- Issue URLì„ í´ë¦½ë³´ë“œ + íŒ¨í‚¤ì§€ ë©”íƒ€ + íŒ¨í‚¤ì§€ markdown 3ê³³ì— ìë™ ì—­ì‚½ì…
- Package â†” Issue ì–‘ë°©í–¥ ì¶”ì  ì™„ì„±

### í•µì‹¬ ë³€ê²½ì‚¬í•­

#### 1. PATCH /api/share-packages ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€

**ëª©ì **: ê¸°ì¡´ íŒ¨í‚¤ì§€ì— issueUrl ì—­ì‚½ì…

**íŒŒì¼**: src/app/api/share-packages/route.ts (line 108-159)

**Request**:
```typescript
PATCH /api/share-packages
Header: x-share-token: {token}
Body: {
  id: string,           // Package ID
  issueUrl: string,     // GitHub Issue URL
  targetRepo?: string,  // Optional: ì €ì¥ì†Œëª…
  issueTitle?: string   // Optional: Issue ì œëª©
}
```

**Response**:
```typescript
{
  ok: true,
  id: "pkg_...",
  issueUrl: "https://github.com/.../issues/XX"
}
```

**êµ¬í˜„**:
```typescript
export async function PATCH(req: Request) {
  try {
    const token = getToken();
    const auth = req.headers.get("x-share-token") || "";

    if (!token || auth !== token) {
      return NextResponse.json({ ok: false, error: "UNAUTHORIZED" }, { status: 401 });
    }

    const body = await req.json();
    const { id, issueUrl, targetRepo, issueTitle } = body;

    if (!id || !issueUrl) {
      return NextResponse.json({ ok: false, error: "MISSING_FIELDS" }, { status: 400 });
    }

    // Validate issueUrl format
    if (!issueUrl.startsWith("http://") && !issueUrl.startsWith("https://")) {
      return NextResponse.json({ ok: false, error: "INVALID_URL" }, { status: 400 });
    }

    const p = packagePath(id);
    if (!fs.existsSync(p)) {
      return NextResponse.json({ ok: false, error: "NOT_FOUND" }, { status: 404 });
    }

    // Read existing package
    const txt = fs.readFileSync(p, "utf-8");
    const pkg = JSON.parse(txt);

    // Update with issueUrl and optional metadata
    pkg.issueUrl = issueUrl;
    if (targetRepo) pkg.targetRepo = targetRepo;
    if (issueTitle) pkg.issueTitle = issueTitle;
    pkg.updatedAt = new Date().toISOString();

    // Write back
    fs.writeFileSync(p, JSON.stringify(pkg, null, 2), "utf-8");

    return NextResponse.json({
      ok: true,
      id,
      issueUrl,
    }, { status: 200 });
  } catch (e: any) {
    return NextResponse.json({ ok: false, error: e?.message ?? String(e) }, { status: 500 });
  }
}
```

**íŠ¹ì§•**:
- **ì¸ì¦**: x-share-token í—¤ë” í•„ìˆ˜
- **ê²€ì¦**: issueUrlì€ http:// ë˜ëŠ” https://ë¡œ ì‹œì‘í•´ì•¼ í•¨
- **Non-destructive**: ê¸°ì¡´ í•„ë“œ ìœ ì§€í•˜ë©° issueUrl, targetRepo, issueTitleë§Œ ì¶”ê°€/ì—…ë°ì´íŠ¸
- **ìë™ íƒ€ì„ìŠ¤íƒ¬í”„**: updatedAt ìë™ ê¸°ë¡

---

#### 2. GET /api/share-packages markdown ì‘ë‹µ í™•ì¥

**ëª©ì **: Package URLë¡œ ì—´ì—ˆì„ ë•Œ ìµœìƒë‹¨ì— Issue URL ì„¹ì…˜ í‘œì‹œ

**íŒŒì¼**: src/app/api/share-packages/route.ts (line 37-41)

**êµ¬í˜„**:
```typescript
// STEP05.29: Prepend Issue URL section if exists
let content = pkg.reportMd;
if (pkg.issueUrl) {
  content = `**Issue URL**: ${pkg.issueUrl}\n\n---\n\n${content}`;
}
```

**Before (íŒ¨í‚¤ì§€ markdown)**:
```markdown
# PM Report (2025-12-26 12:00:00)

**Package ID**: pkg_123...
**Snapshot**: Auto_2025_12_26_12_00_00

---

## Summary
...
```

**After (issueUrl ìˆì„ ë•Œ)**:
```markdown
**Issue URL**: https://github.com/ajong3287/50_í€´ì¦ˆë„ì „ê°œë°œ/issues/42

---

# PM Report (2025-12-26 12:00:00)

**Package ID**: pkg_123...
**Snapshot**: Auto_2025_12_26_12_00_00

---

## Summary
...
```

**íš¨ê³¼**: Package URL ì—´ë©´ ì¦‰ì‹œ Issueë¡œ ì´ë™ ê°€ëŠ¥

---

#### 3. createGithubIssue() 3ê³³ ì—­ì‚½ì… ë¡œì§

**ëª©ì **: Issue ìƒì„± ì„±ê³µ í›„ ìë™ìœ¼ë¡œ 3ê³³ì— URL ì‚½ì…

**íŒŒì¼**: src/app/map/MapClient.tsx (line 1088-1112)

**ë³€ê²½ íë¦„**:
```typescript
// Before
1. Issue ìƒì„± â†’ issueUrl íšë“
2. setLastIssueUrl(issueUrl)
3. í´ë¦½ë³´ë“œ ë³µì‚¬: issueUrlë§Œ
4. ìƒˆ íƒ­ ì—´ê¸°

// After
1. Issue ìƒì„± â†’ issueUrl íšë“
2. setLastIssueUrl(issueUrl)
3. PATCH /api/share-packages (non-blocking) â† ì¶”ê°€
4. í´ë¦½ë³´ë“œ ë³µì‚¬: **Issue URL**: {url}\n\n{url} â† ë³€ê²½
5. ìƒˆ íƒ­ ì—´ê¸°
```

**ì½”ë“œ** (line 1088-1112):
```typescript
// STEP05.29: Backlink issueUrl to existing package metadata
if (lastPkgId && shareUploadToken) {
  try {
    setSnapMsg("ğŸ”— Linking Issue URL to Package...");
    await fetch("/api/share-packages", {
      method: "PATCH",
      headers: {
        "x-share-token": shareUploadToken,
        "content-type": "application/json",
      },
      body: JSON.stringify({
        id: lastPkgId,
        issueUrl,
        targetRepo,
        issueTitle: title,
      }),
    });
  } catch (patchErr) {
    // Non-blocking: Package metadata update failed but issue created successfully
    console.warn("Package metadata update failed:", patchErr);
  }
}

// STEP05.29: Prepare clipboard text with Issue URL header
const clipboardText = `**Issue URL**: ${issueUrl}\n\n${issueUrl}`;
```

**Non-blocking ì „ëµ**:
- PATCH ì‹¤íŒ¨í•´ë„ Issue ìƒì„± ì„±ê³µ ìœ ì§€
- console.warnìœ¼ë¡œ ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  ê³„ì† ì§„í–‰
- í´ë¦½ë³´ë“œ ë³µì‚¬ëŠ” í•­ìƒ Issue URL í¬í•¨

---

### ë³€ê²½ íŒŒì¼
```
1. src/app/api/share-packages/route.ts (ìˆ˜ì •)     - PATCH ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ + GET markdown í™•ì¥
2. src/app/map/MapClient.tsx (ìˆ˜ì •)               - createGithubIssue() ì—­ì‚½ì… ë¡œì§ ì¶”ê°€
```

### ì»¤ë°‹
```
e64bd27e feat: step05.29 issue url backlink to package/report (NEURALMAP-STEP05.29-v0.1)
```

---

## ì£¼ìš” ê¸°ìˆ  ì„¸ë¶€ì‚¬í•­

### 1. ì™„ì „ íë£¨í”„ êµ¬ì¡°

**Before (STEP05.28ê¹Œì§€)**:
```
02ë²ˆ ë¶„ì„ â†’ Share Package ì—…ë¡œë“œ â†’ GitHub Issue ìƒì„±
                â†“
          Package ID/URL íšë“
                â†“
        Issueì— Package URL í¬í•¨
```

**ë¬¸ì œ**: Package â†’ IssueëŠ” ë‹¨ë°©í–¥, Issue â†’ Package ì—­ì¶”ì  ë¶ˆê°€ëŠ¥

**After (STEP05.29)**:
```
02ë²ˆ ë¶„ì„ â†’ Share Package ì—…ë¡œë“œ â†’ GitHub Issue ìƒì„±
                â†“                           â†“
          Package ID/URL íšë“          Issue URL íšë“
                â†“                           â†“
        Issueì— Package URL í¬í•¨ â† PATCH â† Packageì— Issue URL ì—­ì‚½ì…
                â†“                           â†“
          í´ë¦½ë³´ë“œ: Issue URL í¬í•¨    Package markdown: Issue URL í‘œì‹œ
```

**íš¨ê³¼**: Package â†” Issue ì–‘ë°©í–¥ ì¶”ì  ì™„ì„±

---

### 2. ì—­ì‚½ì… 3ê³³ ìƒì„¸

#### 1) í´ë¦½ë³´ë“œ (ì¦‰ì‹œ)
```typescript
const clipboardText = `**Issue URL**: ${issueUrl}\n\n${issueUrl}`;
await navigator.clipboard.writeText(clipboardText);
```

**Before í´ë¦½ë³´ë“œ**:
```
https://github.com/ajong3287/50_í€´ì¦ˆë„ì „ê°œë°œ/issues/42
```

**After í´ë¦½ë³´ë“œ**:
```
**Issue URL**: https://github.com/ajong3287/50_í€´ì¦ˆë„ì „ê°œë°œ/issues/42

https://github.com/ajong3287/50_í€´ì¦ˆë„ì „ê°œë°œ/issues/42
```

**íš¨ê³¼**: Cmd+Vë¡œ ë¶™ì—¬ë„£ìœ¼ë©´ ì œëª© + URL í•¨ê»˜ ê³µìœ 

---

#### 2) Package ë©”íƒ€ë°ì´í„° (PATCH)
```typescript
// .data/share-packages/pkg_123.json
{
  "id": "pkg_123...",
  "kind": "dev",
  "reportMd": "...",
  "snapshot": { ... },
  "normalizedUrl": "...",
  "createdAt": "2025-12-26T12:00:00Z",
  "issueUrl": "https://github.com/.../issues/42",      // â† ì¶”ê°€
  "targetRepo": "ajong3287/50_í€´ì¦ˆë„ì „ê°œë°œ",           // â† ì¶”ê°€
  "issueTitle": "[DEV] í€´ì¦ˆ ì ìˆ˜ ì €ì¥ ì•ˆë¨",           // â† ì¶”ê°€
  "updatedAt": "2025-12-26T12:05:30Z"                  // â† ì¶”ê°€
}
```

**íš¨ê³¼**: Package IDë¡œ Issue URL ì—­ì¶”ì  ê°€ëŠ¥

---

#### 3) Package markdown (GET ìë™ ì²˜ë¦¬)
```typescript
// GET /api/share-packages?id=pkg_123 ì‘ë‹µ
if (pkg.issueUrl) {
  content = `**Issue URL**: ${pkg.issueUrl}\n\n---\n\n${content}`;
}
```

**Before Package URL ì—´ì—ˆì„ ë•Œ**:
```markdown
# DEV Report (2025-12-26 12:00:00)

**Package ID**: pkg_123...
...
```

**After Package URL ì—´ì—ˆì„ ë•Œ**:
```markdown
**Issue URL**: https://github.com/.../issues/42

---

# DEV Report (2025-12-26 12:00:00)

**Package ID**: pkg_123...
...
```

**íš¨ê³¼**: Package URL â†’ Issue URL 1í´ë¦­ ì´ë™

---

### 3. Non-blocking ì—ëŸ¬ ì²˜ë¦¬

**PATCH ì‹¤íŒ¨í•´ë„ Issue ìƒì„± ì„±ê³µ ìœ ì§€**:
```typescript
try {
  await fetch("/api/share-packages", { method: "PATCH", ... });
} catch (patchErr) {
  // Non-blocking: Package metadata update failed but issue created successfully
  console.warn("Package metadata update failed:", patchErr);
}
```

**ì´ìœ **:
- Issue ìƒì„±ì´ ì£¼ìš” ëª©ì 
- Package ë©”íƒ€ ì—…ë°ì´íŠ¸ëŠ” ë¶€ê°€ ê¸°ëŠ¥
- ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì • í™˜ê²½ ëŒ€ì‘

**ê²°ê³¼**:
- IssueëŠ” í•­ìƒ ìƒì„±ë¨ (ì„±ê³µ ë³´ì¥)
- Package ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ ì‹œ console.warnë§Œ
- ì‚¬ìš©ìì—ê²ŒëŠ” "Issue created!" ë©”ì‹œì§€

---

## ê²€ì¦ ì™„ë£Œ ì‚¬í•­

- [x] **pnpm build**: Exit 0
- [x] **TypeScript**: íƒ€ì… ê²€ì‚¬ í†µê³¼
- [x] **Next.js 14.2.35**: ì •ì  í˜ì´ì§€ 16ê°œ ìƒì„± ì„±ê³µ
- [x] **íŒŒì¼ ë³€ê²½**: 2ê°œ (route.ts, MapClient.tsx)
- [x] **base**: main
- [x] **ì™¸ë¶€ íŒ¨í‚¤ì§€ ì¶”ê°€ ì—†ìŒ** (Next.js í‘œì¤€ë§Œ ì‚¬ìš©)

---

## ROI ë¶„ì„

### ì¶”ê°€ ì‹œê°„ ì ˆê° (ì›” 30ê±´ ê¸°ì¤€)

**ì´ 3~8ì‹œê°„/ì›” ì¶”ê°€ ì ˆê°**:

1. **ë§í¬ ëˆ„ë½ ì¬ê³µìœ  ì œê±°** (2~3ì‹œê°„/ì›”)
   - Before: "ì´ Issue ì–´ë–¤ Packageë¡œ ë§Œë“¤ì—ˆì§€?" â†’ Package ID ìˆ˜ë™ ê²€ìƒ‰ (5ë¶„/ê±´)
   - After: Package markdown ìµœìƒë‹¨ì— Issue URL â†’ ì¦‰ì‹œ í™•ì¸ (0ë¶„)

2. **ì¬í˜„ íë¦„ ë‹¨ì¶•** (1~2ì‹œê°„/ì›”)
   - Before: Issue ë³´ê³  â†’ Package ì°¾ê¸° â†’ URL ìˆ˜ë™ ë³µì‚¬ â†’ ì—´ê¸° (3ë¶„/ê±´)
   - After: Issue ë³´ê³  â†’ Package markdown ìµœìƒë‹¨ í´ë¦­ â†’ Issue ì—´ê¸° (10ì´ˆ)

3. **ì´ìŠˆ íˆìŠ¤í† ë¦¬ ìë™ ê¸°ë¡** (1~2ì‹œê°„/ì›”)
   - Before: "ì´ Packageë¡œ ë¬´ìŠ¨ Issue ë§Œë“¤ì—ˆì§€?" â†’ ìˆ˜ë™ ê²€ìƒ‰ (4ë¶„/ê±´)
   - After: Package metadataì— issueUrl ìë™ ê¸°ë¡ â†’ ì¦‰ì‹œ í™•ì¸ (0ë¶„)

4. **í´ë¦½ë³´ë“œ ê³µìœ  ê°œì„ ** (1ì‹œê°„/ì›”)
   - Before: Issue URLë§Œ ë³µì‚¬ â†’ ë°›ëŠ” ì‚¬ëŒì´ "ì´ê²Œ ë­ì§€?" (2ë¶„/ê±´)
   - After: **Issue URL**: {url} í˜•íƒœë¡œ ë³µì‚¬ â†’ ëª…í™•í•œ ì»¨í…ìŠ¤íŠ¸ (0ë¶„)

### ëˆ„ì  íš¨ê³¼ (STEP05.27 + STEP05.28 + STEP05.29)

| í•­ëª© | Before | After | ì ˆê° |
|-----|--------|-------|------|
| 1ê±´ë‹¹ ì‹œê°„ | 38ë¶„ | 3ë¶„ | **35ë¶„** â†“ |
| ì›” 30ê±´ ê¸°ì¤€ | 19ì‹œê°„ | 1.5ì‹œê°„ | **17.5ì‹œê°„** â†“ |
| STEP05.28 ì¶”ê°€ | - | - | **+15ì‹œê°„** â†“ |
| STEP05.29 ì¶”ê°€ | - | - | **+3~8ì‹œê°„** â†“ |
| **ì´ ì ˆê°** | 19ì‹œê°„ | 1.5ì‹œê°„ | **35.5~40.5ì‹œê°„/ì›”** â†“ |

**ì—°ê°„ ì ˆê°**: 426~486ì‹œê°„ = **53~60ì¼ë¶„** ì—…ë¬´ ì‹œê°„

---

## 50ë²ˆ í”„ë¡œì íŠ¸ ìš´ì˜ ê·œì¹™ í™•ì •

### "Issue URL í¬í•¨ëœ Packageë§Œ ìœ íš¨" í‘œì¤€

**Before (STEP05.28ê¹Œì§€)**:
- Package ìˆìœ¼ë©´ ì¬í˜„ ê°€ëŠ¥
- í•˜ì§€ë§Œ "ì–´ë–¤ Issue?" ì—­ì¶”ì  ë¶ˆê°€ëŠ¥

**After (STEP05.29)**:
- **Package ìƒì„± â†’ Issue ìƒì„± â†’ Package ì—…ë°ì´íŠ¸** í•„ìˆ˜ í”Œë¡œìš°
- issueUrl ì—†ëŠ” Package = ë¯¸ì™„ì„± Package
- Issue URLë¡œ Package ìœ íš¨ì„± ê²€ì¦

### ë¦¬ë·°/ì¬í˜„ í”„ë¡œì„¸ìŠ¤ í™•ì •

**1. Issue ìƒì„± ì‹œ**:
```
âœ… Auto Upload ON
âœ… ğŸš€ Create Issue (Dev/PM) í´ë¦­
âœ… Issue URL ìë™ íšë“
âœ… Package metadata ìë™ ì—…ë°ì´íŠ¸
```

**2. Issue ë¦¬ë·° ì‹œ**:
```
1. Issue bodyì—ì„œ Package URL í´ë¦­
2. Package markdown ìµœìƒë‹¨ì—ì„œ Issue URL í™•ì¸ (ì—­ê²€ì¦)
3. Debug Hintsë¡œ ì¡°ì‚¬ ì‹œì‘ì  íŒŒì•…
4. 50ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ ì¬í˜„
```

**3. Package ê³µìœ  ì‹œ**:
```
1. Package URL ê³µìœ 
2. ë°›ëŠ” ì‚¬ëŒ: markdown ìµœìƒë‹¨ Issue URL í´ë¦­
3. Issueì—ì„œ Package URL ì¬í™•ì¸ (ì–‘ë°©í–¥ ê²€ì¦)
4. ì™„ì „í•œ ì»¨í…ìŠ¤íŠ¸ë¡œ í˜‘ì—…
```

---

## ë‹¤ìŒ ë‹¨ê³„

### STEP05.30 (ì˜ˆì •): í†µê³„ ëŒ€ì‹œë³´ë“œ

**ëª©ì **: 02ë²ˆâ†’50ë²ˆ ì´ìŠˆ ìƒì„± í†µê³„ ìë™ ì§‘ê³„

**êµ¬í˜„ ë°©ì•ˆ**:
1. Issue ìƒì„± ì¹´ìš´íŠ¸ (ì¼/ì£¼/ì›”)
2. Package ì¬ì‚¬ìš©ë¥  ì¸¡ì •
3. í‰ê·  Issue ìƒì„± ì‹œê°„ ì¶”ì 
4. ROI ì‹¤ì‹œê°„ ê³„ì‚°

**ì˜ˆìƒ íš¨ê³¼**:
- ì‹¤ì œ ì‹œê°„ ì ˆê° ì •ëŸ‰ ì¸¡ì •
- íŒ€ ìƒì‚°ì„± ì§€í‘œ ìë™ ìƒì„±
- ê°œì„ ì  ë°ì´í„° ê¸°ë°˜ ë°œê²¬

---

**ì‘ì—… ì™„ë£Œ ì‹œê°**: 2025-12-26 23:30
**ìµœì¢… ìƒíƒœ**: PR #39 ìƒì„± ì™„ë£Œ, main ë³‘í•© ëŒ€ê¸°
**ì»¤ë°‹**: e64bd27e
**ë¸Œëœì¹˜**: feat/STEP05.29-ISSUE-URL-BACKLINK
