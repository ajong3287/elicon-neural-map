# v2.2 코드 분석 결과

**날짜**: 2025-12-22
**분석 대상**: src/app/map/page.tsx 및 관련 파일
**목적**: 인터랙션 이벤트 + 커스텀 노드/엣지 타입

---

## GPT 요청 내용

> [7] ReactFlow 인터랙션 이벤트 (onNodeClick, fitView 등)
> [8] 커스텀 노드/엣지 타입 파일 + type 속성 매칭

---

## 실행 명령어

### [7] 인터랙션 이벤트

```bash
rg -n "onNodeClick|onEdgeClick|onConnect|onInit|onMove|onPaneClick|onSelectionChange|fitView|zoomIn|zoomOut|setViewport|Viewport|Controls|MiniMap|Background|proOptions|nodeTypes|edgeTypes|defaultEdgeOptions" src/app/map/page.tsx src -S
```

### [8] 커스텀 타입 파일

```bash
find src -type f \( -iname "*node*.tsx" -o -iname "*edge*.tsx" -o -iname "*nodes*.tsx" -o -iname "*edges*.tsx" -o -iname "*reactflow*.tsx" -o -iname "*graph*.tsx" \) -print | sort
```

### [8] type 속성 매칭

```bash
rg -n "nodeTypes|edgeTypes|type:\\s*['\"][^'\"]+['\"]" src/app/map/page.tsx src -S
```

---

## 분석 결과

### [7] 인터랙션 이벤트

```
--- rg 결과 전문 시작 ---
(결과 없음)
--- rg 결과 전문 끝 ---
```

**이유**: Cytoscape 사용, ReactFlow 이벤트 핸들러 없음

**실제 Cytoscape 이벤트**:
- `cy.on('tap', 'node', handler)` - 노드 클릭
- `cy.layout().run()` - 레이아웃 재실행
- `cy.fit()` - 화면 맞춤

### [8] 파일 목록

```
--- 출력 전문 시작 ---
(결과 없음)
--- 출력 전문 끝 ---
```

**이유**: 커스텀 노드/엣지 컴포넌트 파일 없음 (Cytoscape 스타일 기반)

### [8] type 속성 매칭

```
--- rg 결과 전문 시작 ---
src/app/map/page.tsx:29:  type: "folder" | "file";
src/app/map/page.tsx:34:  const root: TreeNode = { name: "ROOT", path: "", type: "folder", children: [] };
src/app/map/page.tsx:190:              type: 'cluster'
src/app/map/page.tsx:374:      cy.on('tap', 'node', (event: any) => {
src/app/map/page.tsx:375:        const node = event.target;
src/app/map/page.tsx:376:        if (node.data('type') === 'cluster') {
--- rg 결과 전문 끝 ---
```

---

## 발견 사항

1. **인터랙션 방식**:
   - ReactFlow 사용 안 함 → ReactFlow 이벤트 없음
   - Cytoscape `cy.on('tap', 'node', handler)` 사용
   - cluster 노드 클릭 시 토글 (접기/펼치기)

2. **타입 시스템**:
   - TreeNode: `type: "folder" | "file"` (좌측 트리용)
   - Cytoscape Node: `type: 'cluster'` (cluster parent 노드 구분)
   - 커스텀 컴포넌트 없음 (Cytoscape 스타일로만 구분)

3. **이벤트 핸들러**:
   ```typescript
   cy.on('tap', 'node', (event: any) => {
     const node = event.target;
     if (node.data('type') === 'cluster') {
       // cluster 토글 로직
     } else {
       // 일반 노드 클릭 → 파일 미리보기
     }
   });
   ```

4. **구조적 특징**:
   - 단일 파일 (page.tsx)
   - 컴포넌트 분리 없음
   - Cytoscape selector + style 기반 렌더링
