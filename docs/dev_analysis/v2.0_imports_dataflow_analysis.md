# v2.0 코드 분석 결과

**날짜**: 2025-12-22
**분석 대상**: src/app/map/page.tsx 및 관련 파일
**목적**: import/state/데이터 흐름 + map 관련 파일 탐색

---

## GPT 요청 내용

> [3] import문, state 변수, 데이터 흐름 80줄
> [4] map 관련 파일 (컴포넌트, 유틸, API)

---

## 실행 명령어

### [3] imports/state/data flow

```bash
nl -ba src/app/map/page.tsx | head -100 | rg "import|useState|useEffect|useMemo|useRef|useSearchParams"
```

### [4] map-related files

```bash
find src -type f \( -iname "*map*" -o -iname "*graph*" -o -iname "*cytoscape*" \) -print | sort
```

---

## 분석 결과

### [3] imports/state/데이터 흐름 (80줄)

```
--- 출력 전문 시작 ---
1  "use client";
2  import { useEffect, useState, useMemo, useRef } from "react";
3  import CytoscapeComponent from "react-cytoscapejs";
4  import Cytoscape from "cytoscape";
5  import fcose from "cytoscape-fcose";
6  import { useSearchParams } from 'next/navigation';
7  import dynamic from 'next/dynamic';

77    const searchParams = useSearchParams();
78
79    const router = typeof window !== 'undefined'
80      ? require('next/navigation').useRouter()
81      : null;
82
83    const [graph, setGraph] = useState<any>(null);
84    const [search, setSearch] = useState(searchParams.get('q') || '');
85    const [selectedFolder, setSelectedFolder] = useState(searchParams.get('folder') || 'all');
86    const [selectedFile, setSelectedFile] = useState<string | null>(null);
87    const [selectedCycleId, setSelectedCycleId] = useState<string | null>(
88      searchParams.get('cycle') || null
89    );
90    const [activeTab, setActiveTab] = useState<'map' | 'logic' | 'data'>('map');
91    const [fileContent, setFileContent] = useState<string>("");
92
93    const [scoreRange, setScoreRange] = useState({
94      min: parseFloat(searchParams.get('scoreMin') || '0'),
95      max: parseFloat(searchParams.get('scoreMax') || '1')
96    });
97
98    const [collapsedClusters, setCollapsedClusters] = useState<Set<string>>(() => {
99      const clustersParam = searchParams.get('clusters');
100     return clustersParam ? new Set(clustersParam.split(',')) : new Set();
--- 출력 전문 끝 ---
```

### [4] map 관련 파일 목록

```
--- 출력 전문 시작 ---
src/app/map
src/app/map/page.tsx
--- 출력 전문 끝 ---
```

---

## 발견 사항

1. **Imports**:
   - React hooks: useEffect, useState, useMemo, useRef
   - Cytoscape: CytoscapeComponent, Cytoscape, fcose
   - Next.js: useSearchParams, useRouter, dynamic

2. **State 관리**:
   - graph: 전체 그래프 데이터
   - search: 검색어
   - selectedFolder: 폴더 필터
   - selectedFile: 선택된 파일 (미리보기용)
   - selectedCycleId: 선택된 cycle (하이라이트용)
   - scoreRange: score 범위 필터 (min/max)
   - collapsedClusters: 접힌 cluster Set

3. **URL 상태 유지**:
   - searchParams에서 초기값 로드
   - query params: q, folder, cycle, scoreMin, scoreMax, clusters

4. **파일 구조**:
   - 단일 파일: src/app/map/page.tsx
   - 유틸/컴포넌트 분리 없음 (모놀리식)
